<!DOCTYPE html>
<html>
<head>
    <title>Register | Expense Tracker</title>

    <!-- Font Awesome -->
    <link rel="stylesheet"
          href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">

    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
</head>
<body>

<div class="auth-container">
    <div class="auth-card">

        <h2>Create Account</h2>
        <p class="auth-subtitle">Track your expenses smartly</p>

        <!-- FLASH MESSAGES -->
        {% with messages = get_flashed_messages(with_categories=true) %}
        {% if messages %}
            {% for category, message in messages %}
                <div class="auth-alert {{ 'auth-success' if category == 'success' else 'auth-error' }}">
                    {{ message }}
                </div>
            {% endfor %}
        {% endif %}
        {% endwith %}

        <form method="POST" onsubmit="return validateForm()">

            <label>Username</label>
            <input type="text" name="username" required>

            <label>Password</label>
            <div class="password-wrapper">
                <input type="password" id="password" name="password"
                       required oninput="checkStrength()" onkeyup="checkCaps(event)">
                <i class="fa-solid fa-eye toggle-password"
                   onclick="togglePassword('password', this)"></i>
            </div>

            <div id="capsWarning" class="password-match error" style="display:none;">
                ⚠ Caps Lock is ON
            </div>

            <div id="strengthText" class="password-strength"></div>

            <label>Confirm Password</label>
            <div class="password-wrapper">
                <input type="password" id="confirm_password"
                       required oninput="checkMatch()">
                <i class="fa-solid fa-eye toggle-password"
                   onclick="togglePassword('confirm_password', this)"></i>
            </div>

            <div id="matchText" class="password-match"></div>

            <button type="submit" id="registerBtn" class="auth-btn" disabled>
                Create Account
            </button>
        </form>

        <div class="auth-footer">
            Already have an account?
            <a href="{{ url_for('login') }}">Login</a>
        </div>

    </div>
</div>

<!-- ================= SCRIPTS ================= -->
<script>
function togglePassword(id, icon) {
    const input = document.getElementById(id);
    const show = input.type === "password";
    input.type = show ? "text" : "password";
    icon.classList.toggle("fa-eye");
    icon.classList.toggle("fa-eye-slash");
}

function checkCaps(e) {
    const warning = document.getElementById("capsWarning");
    warning.style.display = e.getModifierState("CapsLock") ? "block" : "none";
}

function checkStrength() {
    const pwd = document.getElementById("password").value;
    const strength = document.getElementById("strengthText");

    if (!pwd) {
        strength.textContent = "";
        strength.className = "password-strength";
        return;
    }

    if (pwd.length < 6) {
        strength.textContent = "Weak password";
        strength.className = "password-strength weak";
    } else if (/[A-Z]/.test(pwd) && /[0-9]/.test(pwd)) {
        strength.textContent = "Strong password";
        strength.className = "password-strength strong";
    } else {
        strength.textContent = "Medium strength password";
        strength.className = "password-strength medium";
    }

    checkMatch();
}

function checkMatch() {
    const pwd = document.getElementById("password").value;
    const confirm = document.getElementById("confirm_password").value;
    const match = document.getElementById("matchText");
    const btn = document.getElementById("registerBtn");

    if (!confirm) {
        match.textContent = "";
        btn.disabled = true;
        return;
    }

    if (pwd !== confirm) {
        match.textContent = "Passwords do not match";
        match.className = "password-match error";
        btn.disabled = true;
    } else {
        match.textContent = "Passwords match ✓";
        match.className = "password-match strong";
        btn.disabled = false;
    }
}

function validateForm() {
    return !document.getElementById("registerBtn").disabled;
}
</script>

</body>
</html>
