<!DOCTYPE html>
<html lang="en">
<head>
    <title>Login | Expense Tracker</title>

    <!-- Font Awesome -->
    <link rel="stylesheet"
          href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">

    <!-- App CSS -->
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
</head>

<body>

<div class="auth-container">
    <div class="auth-card fade-in">

        <h2>üîê Welcome Back</h2>
        <p class="auth-subtitle">Login to manage and track your expenses</p>

        <!-- FLASH MESSAGES -->
        {% with messages = get_flashed_messages(with_categories=true) %}
        {% if messages %}
            {% for category, message in messages %}
                <div class="auth-alert auth-error">
                    {{ message }}
                </div>
            {% endfor %}
        {% endif %}
        {% endwith %}

        <form method="POST" onsubmit="handleSubmit()">

            <!-- Username -->
            <label>Username</label>
            <input type="text"
                   name="username"
                   required
                   autocomplete="username"
                   placeholder="Enter your username">

            <!-- Password -->
            <label>Password</label>
            <div class="password-wrapper">
                <input type="password"
                       name="password"
                       id="password"
                       required
                       autocomplete="current-password"
                       placeholder="Enter your password"
                       onkeyup="checkCaps(event)">
                <i class="fa-solid fa-eye toggle-password"
                   id="toggleIcon"
                   onclick="togglePassword()"></i>
            </div>

            <!-- Caps Lock Warning -->
            <div id="capsWarning"
                 class="password-match error"
                 style="display:none;">
                ‚ö† Caps Lock is ON
            </div>

            <!-- Submit -->
            <button type="submit"
                    class="auth-btn"
                    id="loginBtn">
                Login
            </button>
        </form>

        <!-- FOOTER -->
        <div class="auth-footer">
            <span style="color:#999; font-size:13px;">
                Forgot password? (Coming soon)
            </span>
            <br><br>
            New here?
            <a href="{{ url_for('register') }}">Create an account</a>
        </div>

    </div>
</div>

<!-- ================= SCRIPTS ================= -->
<script>
const passwordInput = document.getElementById("password");
const toggleIcon = document.getElementById("toggleIcon");
const loginBtn = document.getElementById("loginBtn");

function togglePassword() {
    const isHidden = passwordInput.type === "password";
    passwordInput.type = isHidden ? "text" : "password";

    toggleIcon.classList.toggle("fa-eye", !isHidden);
    toggleIcon.classList.toggle("fa-eye-slash", isHidden);
}

function checkCaps(e) {
    const warning = document.getElementById("capsWarning");
    if (!e.getModifierState) return;
    warning.style.display = e.getModifierState("CapsLock") ? "block" : "none";
}

function handleSubmit() {
    loginBtn.disabled = true;
    loginBtn.innerHTML = '<i class="fa-solid fa-spinner fa-spin"></i> Logging in...';
}
</script>

</body>
</html>
